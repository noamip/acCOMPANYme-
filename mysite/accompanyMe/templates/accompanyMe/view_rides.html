{% extends "base.html" %}
{% load static %}
{% block content %}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript">
    $( document ).ready(function() {
        var previous = '';
       setInterval(function(){
            $.getJSON('api/update/',
                    function (data) {
                        // if (data.stringify() === previous)
                        //     return;
                        // previous = data.stringify();
                       var d=data.serializeArray();
                        var tr;
                         $('#myTable tbody').html("");

                        for (var i = 0; i < d.length; i++) {
                            tr = $('<tr/>');
                            tr.append("<td>" + d[i].destination + "</td>");
                            tr.append("<td>" + d[i].date + "</td>");
                            tr.append("<td>" + d[i].hour + "</td>");
                            tr.append("<td>" + d[i].num_of_available_places + "</td>");
                             $('#myTable tbody').append(tr);
                        }
                    }).fail(function( jqxhr, textStatus, error ) {
                        var err = textStatus + ", " + error;
                        console.log( "Request Failed: " + err );
                    });
       },500);
    });

</script>
<h1>join the ride</h1>
<!--<meta http-equiv="refresh" content="3">-->
<div class="container">
    <table class="table table-hover" id='myTable'>
        <tr class="success">
            <th>Destination</th>
            <th>Hour</th>
            <th>Num Available places</th>
            <th>Code</th>
        </tr>
        {% for object in object_list %}
        <tr class="info">

            <!--<td>-->
            <!--<a href="{% url "accompanyMe:detail" object.id %}">-->
            <!--&lt;!&ndash;{{ object.id }}&ndash;&gt;-->
            <!--</a>-->
            <!--</td>-->
            <td>
                {{ object.destination }}
            </td>
            <td>
                {{ object.hour }}
            </td>
            <td>
                {{ object.num_of_available_places }}
            </td>
            <td>
                <!--<img width="90" height="90"-->
                <!--src="{% url "accompanyMe:bar_code" object.id %}"/>-->
                <img width="90" height="90" src="data:image/png;base64,{{object.qr_base64}}"/>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>
<script src="/static/vendor/jquery-3.3.1.js"></script>
<script src="/static/js/ajax-reload.js"></script>
{% endblock %}



